---

title:   (施工中) 不要借用别人的身份证  
category: flaw  
layout: default

---

### 意想不到的惊喜

最近接手的一个遗留项目要上线了，却发现了一件有趣的事。  
该产品的终端用户可以通过产品的UI管理一种业务对象，我们假设它叫Foo。
产品内部集成了一个第三方系统，在两个限界上下文中存在一对映射关系，即每个Foo都对应该第三方系统中的一个对象Bar。
在试生产环境中，终端用户已经把上线时需要的数据都录入好了，在之后的测试中也一直运行得不错。
现在生产环境已经安装完毕，为了减少终端用户的工作量，我们试着导入试生产环境的数据，结果发现了意想不到的问题：
生产环境中Foo和Bar的对应关系失效了！当用户操作Foo并修改借此想要修改Bar时，系统总是提示找不到对应的Bar。

最后问题被找到了，该第三方系统的导出功能并不会导出Bar的identity，其导入功能会原封不动的恢复导出的数据，但是id除外！
它会根据内部规则生成一个新的id，因此原先保存的对应关系失效了。
我们编写了一个小脚步为生产环境修复了这个问题，但是有一个小细节引起了我的注意。
有几个编辑Foo的功能，其底层并未交互第三方系统，但也神奇的失败了，提示找不到对应的Foo。
原来所有操作的Foo的功能，从UI到底层都在使用Bar的id作为标识……

### 具有唯一性的未必可以用来做identity



### 教训